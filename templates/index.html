<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>Click EA Tool Pro</title>
  <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
  <style>
    body {
      background: linear-gradient(135deg, #f7f8fa 0%, #e9ecf1 100%);
      font-family: 'Segoe UI', 'Hiragino Kaku Gothic ProN', sans-serif;
    }
    h1 {
      text-align: center;
      font-weight: 700;
      color: #333;
      margin-top: 30px;
    }
    .card {
      max-width: 420px;
      margin: 30px auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 8px 18px rgba(0, 0, 0, 0.1);
      padding: 25px;
      transition: all 0.3s ease;
    }
    .card:hover {
      box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
    }
    .btn-primary {
      background: linear-gradient(90deg, #ffcc00, #ff9933);
      border: none;
      color: #333;
      font-weight: bold;
      transition: 0.3s;
    }
    .btn-primary:hover {
      background: linear-gradient(90deg, #ff9933, #ff6600);
      transform: scale(1.03);
    }
    .btn-danger {
      background: linear-gradient(90deg, #dc3545, #a71d2a);
      border: none;
    }
    .btn-secondary {
      background: linear-gradient(90deg, #6c757d, #5a6268);
      border: none;
    }
    label {
      font-weight: 600;
      color: #333;
    }
    input[type="range"] {
      accent-color: #007bff;
    }
    footer {
      text-align: center;
      margin-top: 40px;
      color: #888;
      font-size: 0.85rem;
    }
  </style>
</head>

<body>
  <h1>âš¡ Click EA Tool Pro</h1>

  <div class="container py-5">
    <!-- å…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ  -->
    <div class="card shadow-sm mb-5" style="max-width: 500px; margin: 0 auto;">
      <label class="form-label">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼</label>
      <input id="entry" type="number" step="0.001" class="form-control mb-3" placeholder="150.000">

      <label class="form-label">æåˆ‡ã‚Šä¾¡æ ¼ï¼ˆSLï¼‰</label>
      <input id="sl" type="number" step="0.001" class="form-control mb-3" placeholder="149.800">

      <label class="form-label">ãƒªã‚¹ã‚¯ãƒªãƒ¯ãƒ¼ãƒ‰ï¼ˆRRï¼‰</label>
      <div class="d-flex align-items-center mb-3">
        <input type="range" id="rrRange" min="0.5" max="5.0" step="0.1" value="2" class="form-range me-2" style="width:80%;">
        <input type="text" id="rrInput" class="form-control text-center" style="width:20%;" value="2">
      </div>

      <label class="form-label">ãƒªã‚¹ã‚¯å‰²åˆï¼ˆï¼…ï¼‰</label>
      <div class="d-flex align-items-center mb-4">
        <input type="range" id="riskRange" min="0.5" max="5.0" step="0.1" value="1" class="form-range me-2" style="width:80%;">
        <input type="text" id="riskInput" class="form-control text-center" style="width:20%;" value="1">
      </div>
    </div>

    <!-- çµæœè¡¨ç¤º -->
    <div id="resultBox" class="result-box" style="display:none;">
      <h5>ğŸ“Š æç›Šè¨ˆç®—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h5>
      <div id="resultText"></div>
    </div>

    <!-- æ“ä½œãƒœã‚¿ãƒ³ -->
    <div class="card text-center mt-5" style="max-width: 500px; margin: 0 auto;">
      <button id="sendTestBtn" class="btn btn-warning btn-lg w-100 mb-3">ğŸš€ OANDAé€ä¿¡ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
      <button id="closeAllBtn" class="btn btn-danger btn-lg w-100 mb-3">ğŸ’£ å…¨æ±ºæ¸ˆï¼ˆãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ã™ã¹ã¦é–‰ã˜ã‚‹ï¼‰</button>
      <button id="resetBtn" class="btn btn-secondary btn-lg w-100">ğŸ”„ ãƒªã‚»ãƒƒãƒˆï¼ˆå…¥åŠ›ãƒ•ã‚©ãƒ¼ãƒ ã‚’ã‚¯ãƒªã‚¢ï¼‰</button>
    </div>
  </div>

  <footer>Â© 2025 Click EA Tool Pro - by Yoshikazu Naritani</footer>

  <script>
    // =======================
    // ã‚¯ãƒªãƒƒã‚¯EA PRO JS
    // =======================

    // RRã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å…¥åŠ›æ¬„ã®é€£å‹•
    const rrRange = document.getElementById("rrRange");
    const rrInput = document.getElementById("rrInput");
    rrRange.addEventListener("input", () => (rrInput.value = rrRange.value));
    rrInput.addEventListener("input", () => (rrRange.value = rrInput.value));

    // ãƒªã‚¹ã‚¯å‰²åˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å…¥åŠ›æ¬„ã®é€£å‹•
    const riskRange = document.getElementById("riskRange");
    const riskInput = document.getElementById("riskInput");
    riskRange.addEventListener("input", () => (riskInput.value = riskRange.value));
    riskInput.addEventListener("input", () => (riskRange.value = riskInput.value));

    // OANDAé€ä¿¡ãƒ†ã‚¹ãƒˆ
    document.getElementById("sendTestBtn").addEventListener("click", async () => {
      const direction = "BUY"; // ä»®å›ºå®šï¼ˆå¾Œã§ã‚¯ãƒªãƒƒã‚¯é€£å‹•äºˆå®šï¼‰
      const entry = parseFloat(document.getElementById("entry").value);
      const sl = parseFloat(document.getElementById("sl").value);
      const rr = parseFloat(document.getElementById("rrInput").value);
      const risk = parseFloat(document.getElementById("riskInput").value);

      try {
        const response = await fetch("/api/order/send-test", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ direction, entry, sl, rr, risk }),
        });
        const result = await response.json();

        // çµæœè¡¨ç¤º
        const resultBox = document.getElementById("resultBox");
        const resultText = document.getElementById("resultText");
        resultBox.style.display = "block";

        resultText.innerHTML = `
          <div>æ–¹å‘ï¼š${result.direction}</div>
          <div>ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼š${result.entry.toFixed(3)}</div>
          <div>æåˆ‡ã‚Šï¼š${result.sl.toFixed(3)}</div>
          <div>åˆ©ç¢ºï¼š${result.tp.toFixed(3)}</div>
          <div>æå¤±å¹…ï¼š${result.pipDiff.toFixed(3)} pips</div>
          <div>RRï¼š${result.rr}</div>
          <div>ãƒªã‚¹ã‚¯å‰²åˆï¼š${result.risk}%</div>
          <div>ãƒ­ãƒƒãƒˆæ•°ï¼š${result.units}</div>
          <div>æå¤±é‡‘é¡ï¼š${result.lossYen.toFixed(2)} å††</div>
          <div>åˆ©ç›Šé‡‘é¡ï¼š${result.profitYen.toFixed(2)} å††</div>
        `;
      } catch (error) {
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
      }
    });

    // å…¨æ±ºæ¸ˆãƒœã‚¿ãƒ³
    document.getElementById("closeAllBtn").addEventListener("click", async () => {
      const res = await fetch("/api/positions/close-all", { method: "POST" });
      const data = await res.json();
      alert(data.closed ? "å…¨ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ" : "å¤±æ•—ã—ã¾ã—ãŸ");
    });

    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("entry").value = "";
      document.getElementById("sl").value = "";
      rrRange.value = 1.3;
      rrInput.value = 1.3;
      riskRange.value = 1;
      riskInput.value = 1;
      document.getElementById("resultBox").style.display = "none";
    });
  </script>
</body>
</html>
