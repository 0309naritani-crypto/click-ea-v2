<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Click EA Tool Pro</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body {
      background-color: #f8f9fa;
      font-family: "Segoe UI", sans-serif;
    }
    .card {
      border-radius: 1rem;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
      background-color: white;
    }
    .btn-custom {
      font-size: 1rem;
      padding: 0.8rem;
      border-radius: 10px;
      width: 100%;
      margin-bottom: 10px;
    }
    #resultBox {
      display: none;
      margin-top: 1.5rem;
      padding: 1.5rem;
      border-radius: 1rem;
      background-color: #ffffff;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
  </style>
</head>

<body class="p-4">
  <div class="container" style="max-width: 500px;">
    <h2 class="mb-4 text-center">ğŸ“ˆ Click EA Tool Pro</h2>

    <div class="card p-4">
      <div class="mb-3">
        <label class="form-label">ã‚¨ãƒ³ãƒˆãƒªãƒ¼ä¾¡æ ¼</label>
        <input id="entry" type="number" step="0.001" class="form-control" placeholder="ä¾‹: 150.000">
      </div>

      <div class="mb-3">
        <label class="form-label">æåˆ‡ã‚Šä¾¡æ ¼ï¼ˆSLï¼‰</label>
        <input id="sl" type="number" step="0.001" class="form-control" placeholder="ä¾‹: 149.000">
      </div>

      <div class="mb-3">
    <label>ãƒªã‚¹ã‚¯ãƒªãƒ¯ãƒ¼ãƒ‰ï¼ˆRRï¼‰</label>
<input type="number" id="riskInput" value="1.3" min="1" max="5" step="0.1" class="input-box">

<label>ãƒªã‚¹ã‚¯å‰²åˆï¼ˆï¼…ï¼‰</label>
<input type="number" id="riskPercent" value="1" min="0.1" max="10" step="0.1" class="input-box">
   
 
      </div>

      <button id="sendTestBtn" class="btn btn-warning btn-custom">ğŸš€ OANDAé€ä¿¡ãƒ†ã‚¹ãƒˆã‚’å®Ÿè¡Œ</button>
      <button id="closeAllBtn" class="btn btn-danger btn-custom">ğŸ’£ å…¨æ±ºæ¸ˆï¼ˆãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ã™ã¹ã¦é–‰ã˜ã‚‹ï¼‰</button>
      <button id="resetBtn" class="btn btn-secondary btn-custom">ğŸ”„ ãƒªã‚»ãƒƒãƒˆ</button>

      <div id="resultBox"></div>
    </div>
  </div>

  <script>
    // =======================
    // ã‚¯ãƒªãƒƒã‚¯EA PROç‰ˆJSï¼ˆå®‰å®šç‰ˆãƒ»ç¸å–ã‚Šãªã—ï¼‰
    // =======================

    // RRã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å…¥åŠ›æ¬„ã®é€£å‹•
    const rrRange = document.getElementById("rrRange");
    const rrInput = document.getElementById("rrInput");
    rrRange.addEventListener("input", () => (rrInput.value = rrRange.value));
    rrInput.addEventListener("input", () => (rrRange.value = rrInput.value));

    // ãƒªã‚¹ã‚¯å‰²åˆã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼ã¨å…¥åŠ›æ¬„ã®é€£å‹•
    const riskRange = document.getElementById("riskRange");
    const riskInput = document.getElementById("riskInput");
    riskRange.addEventListener("input", () => (riskInput.value = riskRange.value));
    riskInput.addEventListener("input", () => (riskRange.value = riskInput.value));

    // OANDAé€ä¿¡ãƒ†ã‚¹ãƒˆ
    document.getElementById("sendTestBtn").addEventListener("click", async () => {
      const direction = "BUY"; // ä»®å›ºå®š
      const entry = parseFloat(document.getElementById("entry").value);
      const sl = parseFloat(document.getElementById("sl").value);
      const rr = parseFloat(document.getElementById("rrInput").value);
      const risk = parseFloat(document.getElementById("riskInput").value);

      try {
        const response = await fetch("/api/order/send-test", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ direction, entry, sl, rr, risk }),
        });

        const result = await response.json();

        const pipDiff = Math.abs(entry - sl);
        const lossYen = (100 * risk).toFixed(2);
        const profitYen = (lossYen * rr).toFixed(2);

        const text = document.getElementById("resultBox");
        text.style.display = "block";
        text.innerHTML = `
          <h5>ğŸ“Š æç›Šè¨ˆç®—ãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼</h5>
          <div>æ–¹å‘ï¼š${result.direction}</div>
          <div>ã‚¨ãƒ³ãƒˆãƒªãƒ¼ï¼š${result.entry.toFixed(3)}</div>
          <div>æåˆ‡ã‚Šï¼š${result.sl.toFixed(3)}</div>
          <div>åˆ©ç¢ºï¼š${result.tp.toFixed(3)}</div>
          <div>æå¤±å¹…ï¼š${pipDiff.toFixed(3)} pips</div>
          <div>RRï¼š${rr}</div>
          <div>ãƒªã‚¹ã‚¯å‰²åˆï¼š${risk}%</div>
          <div>ãƒ­ãƒƒãƒˆæ•°ï¼š${result.units}</div>
          <div class="mt-2">æå¤±é‡‘é¡ï¼š${lossYen} å††</div>
          <div>åˆ©ç›Šé‡‘é¡ï¼š${profitYen} å††</div>
        `;
      } catch (error) {
        alert("é€šä¿¡ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ã¾ã—ãŸ: " + error.message);
      }
    });

    // å…¨æ±ºæ¸ˆãƒœã‚¿ãƒ³
    document.getElementById("closeAllBtn").addEventListener("click", async () => {
      const res = await fetch("/api/positions/close-all", { method: "POST" });
      const data = await res.json();
      alert(data.closed ? "å…¨ãƒã‚¸ã‚·ãƒ§ãƒ³ã‚’ã‚¯ãƒ­ãƒ¼ã‚ºã—ã¾ã—ãŸ" : "å¤±æ•—ã—ã¾ã—ãŸ");
    });

    // ãƒªã‚»ãƒƒãƒˆãƒœã‚¿ãƒ³
    document.getElementById("resetBtn").addEventListener("click", () => {
      document.getElementById("entry").value = "";
      document.getElementById("sl").value = "";
      rrRange.value = 1.3;
      rrInput.value = 1.3;
      riskRange.value = 1;
      riskInput.value = 1;
      document.getElementById("resultBox").style.display = "none";
    });
  </script>
</body>
</html>
